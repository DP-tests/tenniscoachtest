<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis AI Coach</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --tennis-green: #2D5F3F;
            --tennis-bright: #7CB342;
            --court-blue: #2A5C7B;
            --off-white: #F8F9F7;
            --charcoal: #2C2C2C;
            --light-gray: #E8EBE6;
        }

        body {
            font-family: 'Archivo', sans-serif;
            background: var(--off-white);
            color: var(--charcoal);
            line-height: 1.6;
        }

        /* Landing Page */
        .landing {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            background: linear-gradient(135deg, var(--tennis-green) 0%, var(--court-blue) 100%);
        }

        .landing-content {
            text-align: center;
            max-width: 700px;
        }

        .app-title {
            font-family: 'DM Serif Display', serif;
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            color: white;
            margin-bottom: 1rem;
        }

        .app-subtitle {
            font-size: 1.25rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 3rem;
            font-weight: 300;
        }

        .cta-button {
            background: white;
            color: var(--tennis-green);
            padding: 1.2rem 3rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        /* App Container */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        .app-container.active {
            display: block;
        }

        /* Header */
        .app-header {
            background: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-family: 'DM Serif Display', serif;
            font-size: 1.8rem;
            color: var(--tennis-green);
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 0.7rem 1.5rem;
            background: transparent;
            border: 2px solid transparent;
            color: var(--charcoal);
            font-weight: 500;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
        }

        .nav-tab:hover {
            background: var(--light-gray);
        }

        .nav-tab.active {
            background: var(--tennis-green);
            color: white;
        }

        /* Content Sections */
        .content-section {
            display: none;
            max-width: 1200px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .content-section.active {
            display: block;
        }

        /* Profile Setup */
        .profile-setup {
            max-width: 800px;
            margin: 0 auto;
        }

        .setup-title {
            font-family: 'DM Serif Display', serif;
            font-size: 2.5rem;
            color: var(--tennis-green);
            margin-bottom: 0.5rem;
        }

        .setup-subtitle {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .form-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .form-section h3 {
            color: var(--tennis-green);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--charcoal);
        }

        input, select, textarea {
            padding: 0.8rem;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--tennis-green);
        }

        .submit-profile {
            background: var(--tennis-green);
            color: white;
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .submit-profile:hover {
            background: var(--tennis-bright);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .submit-profile:disabled {
            background: #999;
            cursor: not-allowed;
            transform: none;
        }

        .submit-profile.loading {
            background: #999;
            cursor: wait;
        }

        /* Section Headers */
        .section-header {
            margin-bottom: 2rem;
        }

        .section-title {
            font-family: 'DM Serif Display', serif;
            font-size: 2.5rem;
            color: var(--tennis-green);
            margin-bottom: 0.5rem;
        }

        .section-description {
            color: #666;
            font-size: 1.1rem;
        }

        /* Equipment Cards */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .equipment-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .equipment-card:hover {
            transform: translateY(-5px);
        }

        .equipment-card h3 {
            color: var(--tennis-green);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .equipment-card p {
            color: #555;
            line-height: 1.8;
        }

        /* Loading */
        .loading-indicator {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .spinner {
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--tennis-green);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Strategy Content */
        .strategy-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        /* Chat */
        .chat-container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chat-messages {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--off-white);
            border-radius: 10px;
        }

        .message {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 10px;
        }

        .message.user {
            background: var(--tennis-green);
            color: white;
            margin-left: 20%;
        }

        .message.assistant {
            background: white;
            border: 2px solid var(--light-gray);
            margin-right: 20%;
        }

        .message-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-family: 'Archivo', sans-serif;
            font-size: 1rem;
        }

        .chat-send {
            background: var(--tennis-green);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-send:hover:not(:disabled) {
            background: var(--tennis-bright);
        }

        .chat-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Coming Soon */
        .coming-soon {
            background: linear-gradient(135deg, var(--court-blue), var(--tennis-green));
            color: white;
            padding: 5rem 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .coming-soon h2 {
            font-family: 'DM Serif Display', serif;
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .coming-soon p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .equipment-grid {
                grid-template-columns: 1fr;
            }

            .message.user,
            .message.assistant {
                margin-left: 0;
                margin-right: 0;
            }

            .chat-input-container {
                flex-direction: column;
            }
        }

        /* Success Notification */
        .success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--tennis-green);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .success-notification.fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(400px);
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div class="landing" id="landing">
        <div class="landing-content">
            <h1 class="app-title">Tennis AI Coach</h1>
            <p class="app-subtitle">Your personalized AI-powered tennis expert. Get tailored equipment recommendations, strategic insights, and coaching guidance.</p>
            <button class="cta-button" id="getStartedBtn">Get Started</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">Tennis AI Coach</div>
                <div class="nav-tabs">
                    <button class="nav-tab active" data-section="profile">Profile</button>
                    <button class="nav-tab" data-section="equipment">Equipment</button>
                    <button class="nav-tab" data-section="strategy">Game Strategy</button>
                    <button class="nav-tab" data-section="medical">Body & Medical</button>
                </div>
            </div>
        </header>

        <!-- Profile Section -->
        <div class="content-section active" id="profileSection">
            <div class="profile-setup">
                <h2 class="setup-title">Build Your Tennis Profile</h2>
                <p class="setup-subtitle">Tell us about yourself so we can provide personalized recommendations</p>

                <div class="form-section">
                    <h3>Personal Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="age">Age</label>
                            <input type="number" id="age" placeholder="e.g., 28">
                        </div>
                        <div class="form-group">
                            <label for="height">Height (cm)</label>
                            <input type="number" id="height" placeholder="e.g., 175">
                        </div>
                        <div class="form-group">
                            <label for="weight">Weight (kg)</label>
                            <input type="number" id="weight" placeholder="e.g., 70">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Tennis Experience</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="gameLevel">Game Level</label>
                            <select id="gameLevel">
                                <option value="">Select level</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                                <option value="professional">Professional</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="frequency">Frequency of Play</label>
                            <select id="frequency">
                                <option value="">How often?</option>
                                <option value="1-2">1-2 times/week</option>
                                <option value="3-4">3-4 times/week</option>
                                <option value="5+">5+ times/week</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="playStyle">Playing Style</label>
                            <select id="playStyle">
                                <option value="">Select style</option>
                                <option value="aggressive">Aggressive baseline</option>
                                <option value="defensive">Defensive</option>
                                <option value="allcourt">All-court</option>
                                <option value="serve-volley">Serve & volley</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Game Details</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="gameType">Primary Game Type</label>
                            <select id="gameType">
                                <option value="">Select type</option>
                                <option value="singles">Singles</option>
                                <option value="doubles">Doubles</option>
                                <option value="both">Both equally</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="courtSurface">Court Surface</label>
                            <select id="courtSurface">
                                <option value="">Select surface</option>
                                <option value="hard">Hard court</option>
                                <option value="clay">Clay</option>
                                <option value="grass">Grass</option>
                                <option value="indoor">Indoor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="swingSpeed">Swing Speed</label>
                            <select id="swingSpeed">
                                <option value="">Select speed</option>
                                <option value="slow">Slow/Moderate</option>
                                <option value="medium">Medium</option>
                                <option value="fast">Fast</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="grip">Forehand Grip</label>
                            <select id="grip">
                                <option value="">Select grip</option>
                                <option value="eastern">Eastern</option>
                                <option value="semi-western">Semi-Western</option>
                                <option value="western">Western</option>
                                <option value="continental">Continental</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bestShot">Best Shot</label>
                            <select id="bestShot">
                                <option value="">Select your strongest shot</option>
                                <option value="forehand">Forehand</option>
                                <option value="backhand">Backhand</option>
                                <option value="serve">Serve</option>
                                <option value="volley">Volley</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="worstShot">Worst Shot</label>
                            <select id="worstShot">
                                <option value="">Select your weakest shot</option>
                                <option value="forehand">Forehand</option>
                                <option value="backhand">Backhand</option>
                                <option value="serve">Serve</option>
                                <option value="volley">Volley</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Physical Considerations</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="injuries">Current Injuries/Pains</label>
                            <textarea id="injuries" rows="3" placeholder="E.g., tennis elbow, shoulder pain..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="armIssues">Arm/Shoulder Issues?</label>
                            <select id="armIssues">
                                <option value="">Select option</option>
                                <option value="none">No issues</option>
                                <option value="minor">Minor discomfort</option>
                                <option value="moderate">Moderate issues</option>
                                <option value="severe">Severe pain</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Current Equipment</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="currentRacquet">Current Racquet (optional)</label>
                            <input type="text" id="currentRacquet" placeholder="E.g., Wilson Pro Staff, Babolat Pure Drive">
                        </div>
                    </div>
                </div>

                <button class="submit-profile" id="saveProfileBtn">Save Profile & Continue</button>
            </div>
        </div>

        <!-- Equipment Section -->
        <div class="content-section" id="equipmentSection">
            <div class="section-header">
                <h2 class="section-title">Equipment Recommendations</h2>
                <p class="section-description">Personalized gear recommendations based on your profile</p>
            </div>
            <div id="equipmentContent">
                <div class="loading-indicator">
                    <p>Complete your profile to get personalized equipment recommendations</p>
                </div>
            </div>
        </div>

        <!-- Strategy Section -->
        <div class="content-section" id="strategySection">
            <div class="section-header">
                <h2 class="section-title">Game Strategy</h2>
                <p class="section-description">Strategic insights and tactical advice</p>
            </div>
            
            <div class="strategy-content" id="strategyContent">
                <div class="loading-indicator">
                    <p>Complete your profile to get personalized strategy recommendations</p>
                </div>
            </div>

            <div class="chat-container" id="strategyChat" style="display: none;">
                <h3 style="margin-bottom: 1rem; color: var(--tennis-green);">Ask Your Strategy Questions</h3>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="E.g., How should I play against a serve-and-volley player?">
                    <button class="chat-send" id="chatSendBtn">Send</button>
                </div>
            </div>
        </div>

        <!-- Medical Section -->
        <div class="content-section" id="medicalSection">
            <div class="coming-soon">
                <h2>Coming Soon</h2>
                <p>Body & Medical section with injury prevention, recovery tips, and workout recommendations</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let userProfile = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('App initialized');
            
            // Load saved profile
            const saved = localStorage.getItem('tennisProfile');
            if (saved) {
                userProfile = JSON.parse(saved);
                populateForm(userProfile);
            }

            // Event listeners
            document.getElementById('getStartedBtn').addEventListener('click', startApp);
            document.getElementById('saveProfileBtn').addEventListener('click', handleSaveProfile);
            document.getElementById('chatSendBtn').addEventListener('click', sendMessage);
            
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Enter key for chat
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });

        function showSuccessNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 2500);
        }

        function startApp() {
            console.log('Starting app');
            document.getElementById('landing').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
        }

        function showSection(sectionName) {
            console.log('Showing section:', sectionName);
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            // Show selected section
            const sectionMap = {
                'profile': 'profileSection',
                'equipment': 'equipmentSection',
                'strategy': 'strategySection',
                'medical': 'medicalSection'
            };
            
            document.getElementById(sectionMap[sectionName]).classList.add('active');
            
            // Update tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.getAttribute('data-section') === sectionName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
        }

        function populateForm(profile) {
            Object.keys(profile).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = profile[key];
                }
            });
        }

        async function handleSaveProfile() {
            console.log('Save profile clicked');
            
            const saveButton = document.getElementById('saveProfileBtn');
            
            // Immediately show loading state
            saveButton.disabled = true;
            saveButton.classList.add('loading');
            const originalText = saveButton.textContent;
            saveButton.textContent = 'Processing...';
            
            // Collect form data
            userProfile = {
                age: document.getElementById('age').value || '30',
                height: document.getElementById('height').value || '175',
                weight: document.getElementById('weight').value || '70',
                gameLevel: document.getElementById('gameLevel').value || 'intermediate',
                frequency: document.getElementById('frequency').value || '3-4',
                playStyle: document.getElementById('playStyle').value || 'allcourt',
                gameType: document.getElementById('gameType').value || 'singles',
                courtSurface: document.getElementById('courtSurface').value || 'hard',
                swingSpeed: document.getElementById('swingSpeed').value || 'medium',
                grip: document.getElementById('grip').value || 'semi-western',
                bestShot: document.getElementById('bestShot').value || 'forehand',
                worstShot: document.getElementById('worstShot').value || 'backhand',
                injuries: document.getElementById('injuries').value || 'None',
                armIssues: document.getElementById('armIssues').value || 'none',
                currentRacquet: document.getElementById('currentRacquet').value || 'None'
            };

            console.log('Profile data:', userProfile);

            // Save to localStorage
            try {
                localStorage.setItem('tennisProfile', JSON.stringify(userProfile));
                console.log('Profile saved to localStorage');
            } catch (e) {
                console.error('Error saving to localStorage:', e);
            }

            // Small delay to show the button state change, then navigate immediately
            setTimeout(() => {
                // Show success message
                showSuccessNotification('âœ“ Profile saved! Generating recommendations...');
                
                // Navigate to equipment section FIRST (no waiting!)
                showSection('equipment');
                
                // Reset button state
                saveButton.disabled = false;
                saveButton.classList.remove('loading');
                saveButton.textContent = originalText;
                
                // Generate recommendations in the background
                generateRecommendationsInBackground();
            }, 300);
        }

        async function generateRecommendationsInBackground() {
            console.log('Starting background generation');
            
            try {
                // Run both simultaneously
                await Promise.all([
                    generateEquipmentRecommendations(),
                    generateStrategyRecommendations()
                ]);
                console.log('All recommendations generated');
            } catch (error) {
                console.error('Error generating recommendations:', error);
            }
        }

        async function generateEquipmentRecommendations() {
            console.log('Generating equipment recommendations');
            const container = document.getElementById('equipmentContent');
            container.innerHTML = `
                <div class="loading-indicator">
                    <div class="spinner"></div>
                    <p><strong>Analyzing your tennis profile...</strong></p>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;">Generating personalized equipment recommendations</p>
                </div>
            `;

            const prompt = `Based on this tennis player profile, provide personalized equipment recommendations:

Age: ${userProfile.age}
Height: ${userProfile.height}cm, Weight: ${userProfile.weight}kg
Game Level: ${userProfile.gameLevel}
Playing Style: ${userProfile.playStyle}
Frequency: ${userProfile.frequency} times per week
Primary Game: ${userProfile.gameType}
Court Surface: ${userProfile.courtSurface}
Swing Speed: ${userProfile.swingSpeed}
Forehand Grip: ${userProfile.grip}
Best Shot: ${userProfile.bestShot}
Worst Shot: ${userProfile.worstShot}
Arm/Shoulder Issues: ${userProfile.armIssues}
Current Injuries: ${userProfile.injuries}
Current Racquet: ${userProfile.currentRacquet}

Please provide specific recommendations for:
1. Racquet (specific models, weight, head size, balance)
2. Strings (type and material)
3. String Tension (specific range in lbs)
4. Essential Accessories

Format each category clearly with explanations.`;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 1000
                    })
                });

                const data = await response.json();
                console.log('API Response:', data);
                
                const recommendations = data.content.find(c => c.type === 'text')?.text || 'Unable to generate recommendations.';
                displayEquipment(recommendations);
            } catch (error) {
                console.error('API Error:', error);
                container.innerHTML = '<div class="loading-indicator"><p>Error generating recommendations. Please try again.</p></div>';
            }
        }

        function displayEquipment(recommendations) {
            const sections = recommendations.split(/(?=\d\.|#+|\*\*)/);
            let html = '<div class="equipment-grid">';

            const titles = ['Racquet Recommendations', 'String Recommendations', 'String Tension', 'Accessories'];
            
            sections.slice(0, 4).forEach((section, index) => {
                if (section.trim()) {
                    const title = titles[index] || `Recommendation ${index + 1}`;
                    const content = section.replace(/^#+\s*|\d+\.\s*|\*\*/g, '').trim();
                    html += `
                        <div class="equipment-card">
                            <h3>${title}</h3>
                            <p>${content}</p>
                        </div>
                    `;
                }
            });

            html += '</div>';
            document.getElementById('equipmentContent').innerHTML = html;
        }

        async function generateStrategyRecommendations() {
            console.log('Generating strategy recommendations');
            const container = document.getElementById('strategyContent');
            container.innerHTML = `
                <div class="loading-indicator">
                    <div class="spinner"></div>
                    <p><strong>Building your game strategy...</strong></p>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;">Creating tactical recommendations for your playing style</p>
                </div>
            `;

            const prompt = `Based on this tennis player profile, provide 3-4 key strategic recommendations:

Game Level: ${userProfile.gameLevel}
Playing Style: ${userProfile.playStyle}
Primary Game: ${userProfile.gameType}
Court Surface: ${userProfile.courtSurface}
Best Shot: ${userProfile.bestShot}
Worst Shot: ${userProfile.worstShot}

Provide specific tactical advice. Keep it practical and actionable.`;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 1000
                    })
                });

                const data = await response.json();
                const strategies = data.content.find(c => c.type === 'text')?.text || 'Unable to generate strategies.';

                container.innerHTML = `<div style="line-height: 1.8; color: #555;">${strategies.replace(/\n/g, '<br>')}</div>`;
                document.getElementById('strategyChat').style.display = 'block';
            } catch (error) {
                console.error('Strategy API Error:', error);
                container.innerHTML = '<div class="loading-indicator"><p>Error generating strategies. Please try again.</p></div>';
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || !userProfile) return;

            const chatMessages = document.getElementById('chatMessages');
            const sendButton = document.getElementById('chatSendBtn');
            
            // Add user message
            chatMessages.innerHTML += `
                <div class="message user">
                    <div class="message-label">You</div>
                    <div>${message}</div>
                </div>
            `;

            input.value = '';
            sendButton.disabled = true;
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Add loading
            chatMessages.innerHTML += `
                <div class="message assistant" id="tempLoading">
                    <div class="message-label">Tennis AI Coach</div>
                    <div>Thinking...</div>
                </div>
            `;

            const prompt = `You are a tennis coach. Player profile:
Game Level: ${userProfile.gameLevel}
Playing Style: ${userProfile.playStyle}
Game Type: ${userProfile.gameType}
Best Shot: ${userProfile.bestShot}
Worst Shot: ${userProfile.worstShot}

Question: ${message}

Provide specific tactical advice. Be concise but helpful.`;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        max_tokens: 1000
                    })
                });

                const data = await response.json();
                const answer = data.content.find(c => c.type === 'text')?.text || 'Sorry, I couldn\'t process that.';

                document.getElementById('tempLoading').remove();
                chatMessages.innerHTML += `
                    <div class="message assistant">
                        <div class="message-label">Tennis AI Coach</div>
                        <div>${answer}</div>
                    </div>
                `;
            } catch (error) {
                console.error('Chat error:', error);
                document.getElementById('tempLoading').remove();
                chatMessages.innerHTML += `
                    <div class="message assistant">
                        <div class="message-label">Tennis AI Coach</div>
                        <div>Sorry, there was an error. Please try again.</div>
                    </div>
                `;
            }

            sendButton.disabled = false;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>